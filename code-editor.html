<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Editor - ProjetVNET</title>
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      margin: 0;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Code Rain Animation */
    .code-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .code-drop {
      position: absolute;
      color: var(--accent-green);
      font-family: 'Courier New', monospace;
      font-size: 16px;
      font-weight: bold;
      opacity: 0.9;
      animation: fall linear infinite;
      text-shadow: 0 0 10px var(--accent-green);
      z-index: 1;
    }

    .code-drop:nth-child(odd) {
      color: var(--accent-gold);
      text-shadow: 0 0 10px var(--accent-gold);
    }

    .code-drop:nth-child(3n) {
      color: #00ff88;
      text-shadow: 0 0 15px #00ff88;
    }

    .code-drop:nth-child(5n) {
      color: #ff6b6b;
      text-shadow: 0 0 12px #ff6b6b;
    }

    @keyframes fall {
      0% {
        transform: translateY(-100vh) rotate(0deg) scale(0.5);
        opacity: 0;
      }
      10% {
        opacity: 1;
        transform: translateY(-90vh) rotate(36deg) scale(1);
      }
      90% {
        opacity: 0.8;
        transform: translateY(90vh) rotate(324deg) scale(1);
      }
      100% {
        transform: translateY(100vh) rotate(360deg) scale(0.5);
        opacity: 0;
      }
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .code-drop.twinkle {
      animation: fall linear infinite, twinkle 2s ease-in-out infinite;
    }

    /* Matrix-style background */
    .matrix-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(30, 255, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(247, 221, 173, 0.1) 0%, transparent 50%),
        linear-gradient(135deg, #0d1117 0%, #1a1a1a 50%, #2a2a2a 100%);
      animation: matrixPulse 8s ease-in-out infinite;
      z-index: 0;
    }

    @keyframes matrixPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    .navbar {
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-light);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
    }

    .logo {
      color: var(--text-light);
      font-size: 1.8em;
      font-weight: 700;
      text-decoration: none;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logo:hover {
      color: var(--accent-green);
      transform: scale(1.05);
    }

    .logo-projet {
      color: var(--text-light);
    }

    .logo-vnet {
      color: var(--accent-gold);
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-btn {
      background: rgba(30, 255, 0, 0.1);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
      font-size: 1.2em;
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-btn:hover {
      background: var(--accent-green);
      color: var(--bg-dark);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(30, 255, 0, 0.4);
    }

    .editor-container {
      display: flex;
      height: 100vh;
      padding-top: 80px;
      position: relative;
      z-index: 10;
      max-width: 1400px;
      margin: 0 auto;
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
    }

    .editor-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(42, 42, 42, 0.9);
      backdrop-filter: blur(10px);
      border-right: 1px solid var(--border-light);
    }

    .editor-header {
      background: rgba(30, 30, 30, 0.9);
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .task-guidance {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 350px;
      max-height: 70vh;
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(15px);
      border: 1px solid var(--accent-green);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(30, 255, 0, 0.3);
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
    }

    .task-guidance.show {
      transform: translateX(0);
    }

    .task-toggle {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: linear-gradient(45deg, var(--accent-green), var(--accent-green-alt));
      border: none;
      border-radius: 50%;
      color: var(--bg-dark);
      font-size: 1.2em;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(30, 255, 0, 0.4);
    }

    .task-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(30, 255, 0, 0.6);
    }

    .task-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      color: var(--accent-green);
      font-weight: 600;
      font-size: 1.1em;
    }

    .task-header i {
      font-size: 1.2em;
    }

    .task-content {
      color: var(--text-light);
      line-height: 1.6;
      font-size: 1em;
    }

    .task-content h4 {
      color: var(--accent-gold);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .task-content ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .task-content li {
      margin-bottom: 8px;
      color: var(--text-light);
    }

    .task-content code {
      background: rgba(0, 0, 0, 0.3);
      color: var(--accent-green);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }

    .editor-title {
      color: var(--accent-green);
      font-size: 1.2em;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .editor-controls {
      display: flex;
      gap: 10px;
    }

    .control-btn {
      background: linear-gradient(45deg, var(--accent-green), var(--accent-green-alt));
      color: var(--bg-dark);
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(30, 255, 0, 0.3);
    }

    .code-editor {
      flex: 1;
      position: relative;
    }

    .CodeMirror {
      height: 100%;
      font-size: 14px;
      line-height: 1.6;
      font-family: 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
      background: #1e1e1e !important;
      color: #d4d4d4 !important;
    }

    .CodeMirror-gutters {
      background: #1e1e1e !important;
      border-right: 1px solid #3e3e3e !important;
    }

    .CodeMirror-linenumber {
      color: #858585 !important;
      font-size: 12px;
    }

    .CodeMirror-cursor {
      border-left: 2px solid #007acc !important;
    }

    .CodeMirror-selected {
      background: #264f78 !important;
    }

    .CodeMirror-focused .CodeMirror-selected {
      background: #264f78 !important;
    }

    /* VS Code-like syntax highlighting */
    .cm-keyword { color: #569cd6 !important; }
    .cm-string { color: #ce9178 !important; }
    .cm-comment { color: #6a9955 !important; font-style: italic; }
    .cm-number { color: #b5cea8 !important; }
    .cm-variable { color: #9cdcfe !important; }
    .cm-variable-2 { color: #4ec9b0 !important; }
    .cm-def { color: #dcdcaa !important; }
    .cm-operator { color: #d4d4d4 !important; }
    .cm-tag { color: #569cd6 !important; }
    .cm-attribute { color: #92c5f8 !important; }
    .cm-property { color: #92c5f8 !important; }
    .cm-builtin { color: #569cd6 !important; }
    .cm-meta { color: #569cd6 !important; }
    .cm-bracket { color: #ffd700 !important; }
    .cm-atom { color: #569cd6 !important; }

    /* Active line highlighting */
    .CodeMirror-activeline-background {
      background: #2a2d2e !important;
    }

    /* Matching brackets */
    .CodeMirror-matchingbracket {
      background: #0e639c !important;
      color: white !important;
    }

    .CodeMirror-nonmatchingbracket {
      background: #f44747 !important;
      color: white !important;
    }

    .preview-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(42, 42, 42, 0.9);
      backdrop-filter: blur(10px);
    }

    .preview-header {
      background: rgba(30, 30, 30, 0.9);
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-title {
      color: var(--accent-gold);
      font-size: 1.2em;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .device-selector {
      display: flex;
      gap: 5px;
    }

    .device-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-light);
      color: var(--text-light);
      padding: 8px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.8em;
      transition: all 0.3s ease;
    }

    .device-btn.active {
      background: var(--accent-green);
      color: var(--bg-dark);
      border-color: var(--accent-green);
    }

    .device-btn:hover {
      background: rgba(30, 255, 0, 0.2);
    }

    .preview-frame {
      flex: 1;
      border: none;
      background: white;
      position: relative;
    }

    .preview-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: auto;
    }

    .iphone-frame {
      width: 280px;
      height: 580px;
      margin: 15px auto;
      background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
      border-radius: 35px;
      padding: 6px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.1);
      position: relative;
      border: 2px solid #333;
    }

    .iphone-screen {
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 32px;
      overflow: hidden;
      position: relative;
    }

    .iphone-dynamic-island {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 126px;
      height: 37px;
      background: #000;
      border-radius: 19px;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .iphone-dynamic-island::before {
      content: '';
      width: 6px;
      height: 6px;
      background: #fff;
      border-radius: 50%;
      margin-right: 4px;
    }

    .iphone-dynamic-island::after {
      content: '';
      width: 4px;
      height: 4px;
      background: #fff;
      border-radius: 50%;
    }

    .iphone-home-indicator {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 134px;
      height: 5px;
      background: #000;
      border-radius: 3px;
      z-index: 10;
    }

    .desktop-frame {
      width: 100%;
      height: 100%;
      background: #f0f0f0;
      position: relative;
    }

    .desktop-topbar {
      height: 30px;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      padding: 0 15px;
      gap: 10px;
    }

    .desktop-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .desktop-dot:nth-child(1) { background: #ff5f57; }
    .desktop-dot:nth-child(2) { background: #ffbd2e; }
    .desktop-dot:nth-child(3) { background: #28ca42; }

    .desktop-content {
      height: calc(100% - 30px);
      background: white;
      overflow: auto;
    }

    .loading-spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--accent-green);
      font-size: 2em;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .editor-container {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
      }
      
      .editor-panel {
        height: 50vh;
      }
      
      .preview-panel {
        height: 50vh;
      }
      
      .iphone-frame {
        width: 300px;
        height: 533px;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <!-- Matrix Background -->
  <div class="matrix-bg"></div>
  
  <!-- Code Rain Animation -->
  <div class="code-rain" id="codeRain"></div>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="logo" onclick="goToDashboard()">
      <span class="logo-projet">PROJET</span><span class="logo-vnet">VNET</span>
    </div>
    
    <div class="nav-right">
      <button class="back-btn" onclick="goBack()" title="Go Back">
        <i class="fas fa-arrow-left"></i>
      </button>
    </div>
  </nav>

  <!-- Code Editor Container -->
  <div class="editor-container">
    <!-- Editor Panel -->
    <div class="editor-panel">
      <div class="editor-header">
        <div class="editor-title">
          <i class="fas fa-code"></i>
          Code Editor
        </div>
        <div class="editor-controls">
          <button class="control-btn" onclick="runCode()">
            <i class="fas fa-play"></i>
            Run
          </button>
          <button class="control-btn" onclick="clearCode()">
            <i class="fas fa-trash"></i>
            Clear
          </button>
          <button class="control-btn" onclick="saveCode()">
            <i class="fas fa-save"></i>
            Save
          </button>
        </div>
      </div>
      
      <!-- Task Toggle Button -->
      <button class="task-toggle" onclick="toggleTask()" title="Toggle Task Panel">
        <i class="fas fa-tasks"></i>
      </button>

      <!-- Task Guidance Section -->
      <div class="task-guidance" id="taskGuidance">
        <div class="task-header">
          <i class="fas fa-tasks"></i>
          <span>Your Task</span>
          <button onclick="toggleTask()" style="background: none; border: none; color: var(--accent-green); font-size: 1.2em; cursor: pointer; margin-left: auto;">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="task-content" id="taskContent">
          <!-- Task content will be loaded here -->
        </div>
      </div>
      <div class="code-editor">
        <textarea id="codeEditor"></textarea>
      </div>
    </div>

    <!-- Preview Panel -->
    <div class="preview-panel">
      <div class="preview-header">
        <div class="preview-title">
          <i class="fas fa-eye"></i>
          Live Preview
        </div>
        <div class="device-selector">
          <button class="device-btn active" onclick="switchDevice('desktop')">
            <i class="fas fa-desktop"></i>
            Desktop
          </button>
          <button class="device-btn" onclick="switchDevice('mobile')">
            <i class="fas fa-mobile-alt"></i>
            Mobile
          </button>
        </div>
      </div>
      <div class="preview-container">
        <div id="previewFrame" class="desktop-frame">
          <div class="desktop-topbar">
            <div class="desktop-dot"></div>
            <div class="desktop-dot"></div>
            <div class="desktop-dot"></div>
          </div>
          <div class="desktop-content" id="previewContent">
            <div class="loading-spinner">
              <i class="fas fa-spinner"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script>
    let editor;
    let currentDevice = 'desktop';
    let currentMode = 'lesson';
    let currentQuiz = null;
    let quizQuestions = [];
    let currentQuestionIndex = 0;
    let quizScore = 0;

    // Initialize CodeMirror editor
    function initEditor() {
      editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
        mode: 'htmlmixed',
        theme: 'default',
        lineNumbers: true,
        autoCloseBrackets: true,
        matchBrackets: true,
        indentUnit: 2,
        tabSize: 2,
        lineWrapping: true,
        highlightSelectionMatches: {showToken: /\w/},
        styleActiveLine: true,
        addModeClass: true,
        indentWithTabs: false,
        smartIndent: true,
        electricChars: true,
        extraKeys: {
          "Ctrl-Space": "autocomplete",
          "F11": function(cm) {
            cm.setOption("fullScreen", !cm.getOption("fullScreen"));
          },
          "Esc": function(cm) {
            if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
          },
          "Ctrl-/": "toggleComment",
          "Ctrl-D": "selectNextOccurrence",
          "Ctrl-F": "findPersistent"
        }
      });

      // Enhanced syntax highlighting
      editor.setOption('addModeClass', true);
      
      // Force refresh to apply syntax highlighting
      setTimeout(() => {
        editor.refresh();
        editor.setOption('mode', 'htmlmixed');
        editor.refresh();
      }, 100);

      // Add event listener to refresh highlighting on content change
      editor.on('change', function() {
        setTimeout(() => {
          editor.refresh();
        }, 10);
      });

      // Set default code
      editor.setValue(`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Web Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to VNET Code Editor!</h1>
        <div class="card">
            <h2>Start Coding</h2>
            <p>Edit the code on the left and see your changes in real-time!</p>
            <button class="btn" onclick="alert('Hello from VNET!')">Click Me!</button>
        </div>
    </div>
</body>
</html>`);

      // Auto-run code when changed
      editor.on('change', function() {
        setTimeout(runCode, 500);
      });
    }

    // Run code function
    function runCode() {
      const code = editor.getValue();
      const previewContent = document.getElementById('previewContent');
      
      // Show loading
      previewContent.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner"></i></div>';
      
      setTimeout(() => {
        try {
          // Create a new iframe for safe code execution
          const iframe = document.createElement('iframe');
          iframe.style.width = '100%';
          iframe.style.height = '100%';
          iframe.style.border = 'none';
          
          previewContent.innerHTML = '';
          previewContent.appendChild(iframe);
          
          // Write code to iframe
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          iframeDoc.open();
          iframeDoc.write(code);
          iframeDoc.close();
        } catch (error) {
          previewContent.innerHTML = `
            <div style="padding: 20px; color: #ff6b6b; font-family: monospace;">
              <h3>Error:</h3>
              <p>${error.message}</p>
            </div>
          `;
        }
      }, 300);
    }

    // Clear code function
    function clearCode() {
      if (confirm('Are you sure you want to clear all code?')) {
        editor.setValue('');
      }
    }

    // Save code function
    function saveCode() {
      const code = editor.getValue();
      const blob = new Blob([code], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'my-code.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Switch device view
    function switchDevice(device) {
      currentDevice = device;
      const previewFrame = document.getElementById('previewFrame');
      const deviceBtns = document.querySelectorAll('.device-btn');
      
      // Update active button
      deviceBtns.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      if (device === 'mobile') {
        previewFrame.innerHTML = `
          <div class="iphone-frame">
            <div class="iphone-dynamic-island"></div>
            <div class="iphone-screen" id="mobilePreview">
              <div class="loading-spinner"><i class="fas fa-spinner"></i></div>
            </div>
            <div class="iphone-home-indicator"></div>
          </div>
        `;
        // Re-run code for mobile view
        setTimeout(() => {
          const code = editor.getValue();
          const mobilePreview = document.getElementById('mobilePreview');
          try {
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.style.borderRadius = '15px';
            
            mobilePreview.innerHTML = '';
            mobilePreview.appendChild(iframe);
            
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(code);
            iframeDoc.close();
          } catch (error) {
            mobilePreview.innerHTML = `
              <div style="padding: 20px; color: #ff6b6b; font-family: monospace; font-size: 12px;">
                <h3>Error:</h3>
                <p>${error.message}</p>
              </div>
            `;
          }
        }, 300);
      } else {
        previewFrame.innerHTML = `
          <div class="desktop-frame">
            <div class="desktop-topbar">
              <div class="desktop-dot"></div>
              <div class="desktop-dot"></div>
              <div class="desktop-dot"></div>
            </div>
            <div class="desktop-content" id="previewContent">
              <div class="loading-spinner"><i class="fas fa-spinner"></i></div>
            </div>
          </div>
        `;
        // Re-run code for desktop view
        setTimeout(runCode, 300);
      }
    }

    // Navigation functions
    function goToDashboard() {
      window.location.href = 'dashboard.html';
    }

    function goBack() {
      window.history.back();
    }

    // Code Rain Animation (same as dashboard)
    function createCodeRain() {
      const codeRain = document.getElementById('codeRain');
      const characters = ['0', '1', '{}', '[]', '()', ';', '=', '!', '&', '|', '<', '>', '/', '\\', '*', '+', '-', '%', 'function', 'const', 'let', 'var', 'if', 'else', 'for', 'while', 'return', 'class', 'import', 'export'];
      
      function createDrop() {
        const drop = document.createElement('div');
        drop.className = 'code-drop';
        
        if (Math.random() < 0.3) {
          drop.classList.add('twinkle');
        }
        
        drop.textContent = characters[Math.floor(Math.random() * characters.length)];
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 4 + 3) + 's';
        drop.style.animationDelay = Math.random() * 1 + 's';
        drop.style.fontSize = (Math.random() * 8 + 12) + 'px';
        
        codeRain.appendChild(drop);
        
        setTimeout(() => {
          if (drop.parentNode) {
            drop.parentNode.removeChild(drop);
          }
        }, 7000);
      }
      
      setInterval(createDrop, 150);
      
      for (let i = 0; i < 20; i++) {
        setTimeout(createDrop, i * 100);
      }
    }

    // Quiz data
    const quizData = {
      html: {
        5: {
          title: "HTML Forms Quiz",
          questions: [
            {
              question: "Create a form with a text input for 'name' and a submit button",
              code: `<!-- Your HTML form code here -->`,
              solution: `<form>
  <label for="name">Name:</label>
  <input type="text" id="name" name="name" required>
  <button type="submit">Submit</button>
</form>`,
              points: 10
            },
            {
              question: "Add a password input field to the form",
              code: `<!-- Add password field to your form -->`,
              solution: `<form>
  <label for="name">Name:</label>
  <input type="text" id="name" name="name" required>
  <label for="password">Password:</label>
  <input type="password" id="password" name="password" required>
  <button type="submit">Submit</button>
</form>`,
              points: 10
            }
          ]
        },
        10: {
          title: "CSS Layout Quiz",
          questions: [
            {
              question: "Create a flexbox container with 3 items that are evenly spaced",
              code: `<!-- Your HTML and CSS code here -->`,
              solution: `<div class="container">
  <div class="item">Item 1</div>
  <div class="item">Item 2</div>
  <div class="item">Item 3</div>
</div>
<style>
.container {
  display: flex;
  justify-content: space-between;
}
.item {
  flex: 1;
  margin: 10px;
  padding: 20px;
  background: #f0f0f0;
}
</style>`,
              points: 15
            }
          ]
        }
      },
      javascript: {
        5: {
          title: "JavaScript Basics Quiz",
          questions: [
            {
              question: "Create a function that takes two numbers and returns their sum",
              code: `// Your JavaScript code here`,
              solution: `function addNumbers(a, b) {
  return a + b;
}

// Test the function
console.log(addNumbers(5, 3)); // Should output 8`,
              points: 10
            }
          ]
        }
      }
    };

    // Initialize quiz mode
    function initQuizMode() {
      const courseType = localStorage.getItem('currentCourse') || 'html';
      const quizId = localStorage.getItem('currentQuiz');
      
      if (quizData[courseType] && quizData[courseType][quizId]) {
        currentQuiz = quizData[courseType][quizId];
        quizQuestions = currentQuiz.questions;
        currentQuestionIndex = 0;
        quizScore = 0;
        
        // Update editor title
        document.querySelector('.editor-title').innerHTML = `
          <i class="fas fa-question-circle"></i>
          ${currentQuiz.title} - Question ${currentQuestionIndex + 1}
        `;
        
        // Load first question
        loadQuestion();
      }
    }

    // Load quiz question
    function loadQuestion() {
      if (currentQuestionIndex < quizQuestions.length) {
        const question = quizQuestions[currentQuestionIndex];
        editor.setValue(question.code);
        runCode();
      } else {
        showQuizResults();
      }
    }

    // Check quiz answer
    function checkQuizAnswer() {
      const userCode = editor.getValue().trim();
      const question = quizQuestions[currentQuestionIndex];
      const solution = question.solution.trim();
      
      // Simple code comparison (can be enhanced)
      const isCorrect = userCode.includes(solution.split('\n')[0].trim()) || 
                       solution.includes(userCode.split('\n')[0].trim());
      
      if (isCorrect) {
        quizScore += question.points;
        showNotification('Correct! +' + question.points + ' points', 'success');
      } else {
        showNotification('Try again! Check your code.', 'error');
      }
      
      return isCorrect;
    }

    // Next question
    function nextQuestion() {
      if (checkQuizAnswer()) {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizQuestions.length) {
          loadQuestion();
        } else {
          showQuizResults();
        }
      }
    }

    // Show quiz results
    function showQuizResults() {
      const totalPoints = quizQuestions.reduce((sum, q) => sum + q.points, 0);
      const percentage = Math.round((quizScore / totalPoints) * 100);
      
      editor.setValue(`<!-- Quiz Complete! -->
<div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
  <h1 style="color: #1eff00;">Quiz Complete!</h1>
  <h2>Your Score: ${quizScore}/${totalPoints} (${percentage}%)</h2>
  <p style="font-size: 1.2em; margin: 20px 0;">
    ${percentage >= 70 ? 'ðŸŽ‰ Congratulations! You passed!' : 'ðŸ“š Keep studying and try again!'}
  </p>
  <button onclick="completeQuiz()" style="
    background: linear-gradient(45deg, #1eff00, #00cc6a);
    color: #0d1117;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    margin-top: 20px;
  ">Complete Quiz</button>
</div>`);
      
      runCode();
    }

    // Complete quiz
    function completeQuiz() {
      const courseType = localStorage.getItem('currentCourse');
      const quizId = localStorage.getItem('currentQuiz');
      
      // Save quiz completion
      const courseProgress = JSON.parse(localStorage.getItem(`courseProgress_${courseType}`) || '{}');
      courseProgress[quizId] = 'completed';
      localStorage.setItem(`courseProgress_${courseType}`, JSON.stringify(courseProgress));
      
      showNotification('Quiz completed! Returning to course...', 'success');
      setTimeout(() => {
        window.location.href = 'course.html';
      }, 2000);
    }

    // Show notification
    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: ${type === 'success' ? 'rgba(30, 255, 0, 0.9)' : 'rgba(255, 71, 87, 0.9)'};
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 10000;
        font-size: 14px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        animation: slideInRight 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Update control buttons for quiz mode
    function updateControlButtons() {
      const controls = document.querySelector('.editor-controls');
      if (currentMode === 'quiz') {
        controls.innerHTML = `
          <button class="control-btn" onclick="checkQuizAnswer()">
            <i class="fas fa-check"></i>
            Check Answer
          </button>
          <button class="control-btn" onclick="nextQuestion()">
            <i class="fas fa-forward"></i>
            Next Question
          </button>
          <button class="control-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
            Back to Course
          </button>
        `;
      } else {
        controls.innerHTML = `
          <button class="control-btn" onclick="runCode()">
            <i class="fas fa-play"></i>
            Run
          </button>
          <button class="control-btn" onclick="clearCode()">
            <i class="fas fa-trash"></i>
            Clear
          </button>
          <button class="control-btn" onclick="saveCode()">
            <i class="fas fa-save"></i>
            Save
          </button>
        `;
      }
    }

    // Lesson content data
    const lessonQuestions = {
      html: {
        1: {
          question: "Create a basic HTML page with a title 'My First Web Page' and a heading that says 'Welcome to HTML!'",
          code: `<!-- Your HTML code here -->`,
          solution: `<!DOCTYPE html>
<html>
<head>
    <title>My First Web Page</title>
</head>
<body>
    <h1>Welcome to HTML!</h1>
</body>
</html>`
        },
        2: {
          question: "Create an image element with src='logo.png', alt='Company Logo', and a link to 'https://example.com' that opens in a new tab",
          code: `<!-- Your HTML code here -->`,
          solution: `<a href="https://example.com" target="_blank">
    <img src="logo.png" alt="Company Logo">
</a>`
        }
      },
      javascript: {
        1: {
          question: "Create a function called 'addNumbers' that takes two parameters and returns their sum. Then call the function with numbers 5 and 3.",
          code: `// Your JavaScript code here`,
          solution: `function addNumbers(a, b) {
    return a + b;
}

console.log(addNumbers(5, 3));`
        }
      }
    };

    // Initialize lesson mode
    function initLessonMode() {
      const courseType = localStorage.getItem('currentCourse') || 'html';
      const lessonId = localStorage.getItem('currentLesson');
      
      if (lessonQuestions[courseType] && lessonQuestions[courseType][lessonId]) {
        const lesson = lessonQuestions[courseType][lessonId];
        
        // Update editor title
        document.querySelector('.editor-title').innerHTML = `
          <i class="fas fa-book"></i>
          Lesson ${lessonId} - Practice
        `;
        
        // Set lesson question
        editor.setValue(lesson.code);
        
        // Show task guidance
        showTaskGuidance(lesson.question);
        
        runCode();
        
        // Update control buttons for lesson mode
        updateControlButtons();
      }
    }

    // Show task guidance
    function showTaskGuidance(question) {
      const taskContent = document.getElementById('taskContent');
      const taskGuidance = document.getElementById('taskGuidance');
      
      // Parse the question and format it nicely
      const lines = question.split('\n').filter(line => line.trim());
      let formattedQuestion = '<h4>Complete the following requirements:</h4><ul>';
      
      lines.forEach(line => {
        if (line.trim()) {
          formattedQuestion += `<li>${line.trim()}</li>`;
        }
      });
      
      formattedQuestion += '</ul>';
      
      taskContent.innerHTML = formattedQuestion;
      taskGuidance.classList.add('show');
    }

    // Toggle task visibility
    function toggleTask() {
      const taskGuidance = document.getElementById('taskGuidance');
      taskGuidance.classList.toggle('show');
    }

    // Check lesson answer
    function checkLessonAnswer() {
      const userCode = editor.getValue().trim();
      const courseType = localStorage.getItem('currentCourse') || 'html';
      const lessonId = localStorage.getItem('currentLesson');
      const lesson = lessonQuestions[courseType] && lessonQuestions[courseType][lessonId];
      
      if (!lesson) return false;
      
      const solution = lesson.solution.trim();
      
      // Simple code comparison
      const isCorrect = userCode.includes(solution.split('\n')[0].trim()) || 
                       solution.includes(userCode.split('\n')[0].trim());
      
      if (isCorrect) {
        showNotification('Great job! Lesson completed!', 'success');
        completeLesson();
      } else {
        showNotification('Try again! Check your code.', 'error');
      }
      
      return isCorrect;
    }

    // Complete lesson
    function completeLesson() {
      const courseType = localStorage.getItem('currentCourse');
      const lessonId = localStorage.getItem('currentLesson');
      
      // Save lesson completion
      const courseProgress = JSON.parse(localStorage.getItem(`courseProgress_${courseType}`) || '{}');
      courseProgress[lessonId] = 'completed';
      localStorage.setItem(`courseProgress_${courseType}`, JSON.stringify(courseProgress));
      
      setTimeout(() => {
        window.location.href = 'course.html';
      }, 2000);
    }

    // Update control buttons for lesson mode
    function updateControlButtons() {
      const controls = document.querySelector('.editor-controls');
      if (currentMode === 'lesson') {
        controls.innerHTML = `
          <button class="control-btn" onclick="checkLessonAnswer()">
            <i class="fas fa-check"></i>
            Check Answer
          </button>
          <button class="control-btn" onclick="runCode()">
            <i class="fas fa-play"></i>
            Run Code
          </button>
          <button class="control-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
            Back to Course
          </button>
        `;
      } else if (currentMode === 'quiz') {
        controls.innerHTML = `
          <button class="control-btn" onclick="checkQuizAnswer()">
            <i class="fas fa-check"></i>
            Check Answer
          </button>
          <button class="control-btn" onclick="nextQuestion()">
            <i class="fas fa-forward"></i>
            Next Question
          </button>
          <button class="control-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
            Back to Course
          </button>
        `;
      } else {
        controls.innerHTML = `
          <button class="control-btn" onclick="runCode()">
            <i class="fas fa-play"></i>
            Run
          </button>
          <button class="control-btn" onclick="clearCode()">
            <i class="fas fa-trash"></i>
            Clear
          </button>
          <button class="control-btn" onclick="saveCode()">
            <i class="fas fa-save"></i>
            Save
          </button>
        `;
      }
    }

    // Initialize everything
    document.addEventListener('DOMContentLoaded', function() {
      // Check URL parameters for mode
      const urlParams = new URLSearchParams(window.location.search);
      currentMode = urlParams.get('mode') || 'lesson';
      
      initEditor();
      runCode();
      
      if (currentMode === 'quiz') {
        initQuizMode();
        updateControlButtons();
      } else if (currentMode === 'lesson') {
        initLessonMode();
        updateControlButtons();
      }
    });
  </script>
</body>
</html>
